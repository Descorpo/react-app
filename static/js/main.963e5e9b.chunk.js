(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{214:function(e,t,n){"use strict";n.r(t);var a,r=n(0),l=n.n(r),c=n(76),o=(n(89),n(6)),u=n(217),s=n(78),i=n.n(s),m=n(13),p=n(79),h={isAuthenticated:!1,user:{}},d=n(53),b=Object(m.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_USER":return{isAuthenticated:!!Object.keys(t.user).length,user:t.user};default:return e}},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{message:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ERROR":return Object(d.a)({},e,{message:t.error});case"REMOVE_ERROR":return Object(d.a)({},e,{message:null});default:return e}},polls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POLLS":return t.polls;default:return e}},currentPoll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_POLL":return t.poll;default:return e}}}),f=Object(m.e)(b,{error:{message:null}},Object(m.d)(Object(m.a)(p.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())),E=function(e){return{type:"ADD_ERROR",error:e}},v=n(5),g=n.n(v),O=n(80),j=n(9),w=n(39),y=n.n(w),R={call:function(){var e=Object(j.a)(g.a.mark(function e(t,n,a){var r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a[t]("".concat("http://localhost:4000/api","/").concat(n),a);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),setToken:function(e){e?y.a.defaults.headers.common.Authorization="Bearer ".concat(e):delete y.a.defaults.headers.common.Authorization}},k=function(e){return{type:"SET_CURRENT_USER",user:e}},N=function(){return function(e){localStorage.clear(),R.setToken(null),e(k({})),e({type:"REMOVE_ERROR"})}},S=function(e){return{type:"SET_POLLS",polls:e}},_=function(e){return{type:"SET_CURRENT_POLL",poll:e}},C=function(e){return function(){var t=Object(j.a)(g.a.mark(function t(n){var a,r;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,R.call("get","polls/".concat(e));case 3:a=t.sent,n(_(a)),n({type:"REMOVE_ERROR"}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),r=t.t0.response.data,n(E(r));case 12:case"end":return t.stop()}},t,null,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()},x=n(220),A=n(215),T=n(219),P=n(218),L=Object(o.b)(function(e){return{error:e.error}})(function(e){var t=e.error;return l.a.createElement(r.Fragment,null,t.message&&l.a.createElement("div",{className:"error"},t.message))}),U=n(16),D=n(17),M=n(18),V=n(21),F=n(19),q=n(20),I=n(3),X=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(V.a)(this,Object(F.a)(t).call(this,e))).state={username:"",password:""},n.handleChange=n.handleChange.bind(Object(I.a)(Object(I.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(I.a)(Object(I.a)(n))),n}return Object(q.a)(t,e),Object(M.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(U.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(e){var t=this.state,n=t.username,a=t.password,r=this.props.authType;e.preventDefault(),this.props.authUser(r||"login",{username:n,password:a})}},{key:"render",value:function(){var e=this.state.username,t=this.state.password;return l.a.createElement("div",null,l.a.createElement("form",{className:"form",onSubmit:this.handleSubmit},l.a.createElement("label",{className:"form-label",htmlFor:"username"},"username"),l.a.createElement("input",{className:"form-input",type:"text",value:e,name:"username",autoComplete:"off",onChange:this.handleChange}),l.a.createElement("label",{className:"form-label",htmlFor:"password"},"password"),l.a.createElement("input",{className:"form-input",type:"password",value:t,name:"password",autoComplete:"off",onChange:this.handleChange}),l.a.createElement("div",{className:"button_center"},l.a.createElement("button",{className:"button",type:"submit"},"Submit"))))}}]),t}(r.Component),B=Object(o.b)(function(){return{}},{authUser:function(e,t){return function(){var n=Object(j.a)(g.a.mark(function n(a){var r,l,c,o;return g.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,R.call("post","auth/".concat(e),t);case 3:r=n.sent,l=r.token,c=Object(O.a)(r,["token"]),localStorage.setItem("jwtToken",l),R.setToken(l),a(k(c)),a({type:"REMOVE_ERROR"}),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),o=n.t0.response.data,a(E(o.message));case 16:case"end":return n.stop()}},n,null,[[0,12]])}));return function(e){return n.apply(this,arguments)}}()},logout:N})(X),z=function(e){var t=e.authType;return e.isAuthenticated?l.a.createElement(P.a,{to:"/"}):l.a.createElement("div",null,l.a.createElement(L,null),l.a.createElement(B,{authType:t}))},J=n(81),W=Object(o.b)(function(e){return{poll:e.currentPoll}},{vote:function(e,t){return function(){var n=Object(j.a)(g.a.mark(function n(a){var r,l;return g.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,R.call("post","polls/".concat(e),t);case 3:r=n.sent,console.log("dtgrsgdrg",r),a(_(r)),a({type:"REMOVE_ERROR"}),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),l=n.t0.response.data.message,a(E(l));case 13:case"end":return n.stop()}},n,null,[[0,9]])}));return function(e){return n.apply(this,arguments)}}()}})(function(e){var t=e.poll,n=e.vote,a=t.options&&t.options.map(function(e){return l.a.createElement("button",{className:"button",onClick:function(){return n(t._id,{answer:e.option})},key:e._id},e.option)}),r=t.options&&{labels:t.options.map(function(e){return e.option}),datasets:[{label:t.question,backgroundColor:t.options.map(function(e){return"#"+Math.random().toString(16).slice(2,8)}),borderColor:"#323643",data:t.options.map(function(e){return e.votes})}]};return l.a.createElement("div",null,l.a.createElement("h3",{className:"poll-title"},t.question),l.a.createElement("div",{className:"button_center"},a),t.options&&l.a.createElement(J.a,{data:r}))}),H=function(){return l.a.createElement("div",null,l.a.createElement(L,null),l.a.createElement(W,null))},Q=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(V.a)(this,Object(F.a)(t).call(this,e))).handleSelect=n.handleSelect.bind(Object(I.a)(Object(I.a)(n))),n}return Object(q.a)(t,e),Object(M.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.getPolls)()}},{key:"handleSelect",value:function(e){this.props.history.push("/poll/".concat(e))}},{key:"render",value:function(){var e=this,t=this.props,n=t.auth,a=t.getPolls,c=t.getUserPolls,o=this.props.polls.map(function(t){return l.a.createElement("li",{onClick:function(){return e.handleSelect(t._id)},key:t._id},t.question)});return l.a.createElement(r.Fragment,null,n.isAuthenticated&&l.a.createElement("div",{className:"button_center"},l.a.createElement("button",{className:"button",onClick:a},"All polls"),l.a.createElement("button",{className:"button",onClick:c},"My polls")),l.a.createElement("ul",{className:"polls"},o))}}]),t}(r.Component),$=Object(o.b)(function(e){return{auth:e.auth,polls:e.polls}},{getPolls:function(){return function(){var e=Object(j.a)(g.a.mark(function e(t){var n,a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.call("get","polls");case 3:n=e.sent,t(S(n)),t({type:"REMOVE_ERROR"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a=e.t0.response.data,t(E(a));case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},getUserPolls:function(){return function(){var e=Object(j.a)(g.a.mark(function e(t){var n,a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.call("get","polls/user");case 3:n=e.sent,t(S(n)),t({type:"REMOVE_ERROR"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a=e.t0.response.data,t(E(a.message));case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},getCurrentPoll:C})(Q),G=function(e){return l.a.createElement("div",null,l.a.createElement(L,null),l.a.createElement($,e))},K=function(e){var t=e.match;return(0,e.getPoll)(t.params.id),l.a.createElement("div",null,l.a.createElement(L,null),l.a.createElement(W,null))},Y=n(54),Z=function(e){function t(e){var n;return Object(D.a)(this,t),(n=Object(V.a)(this,Object(F.a)(t).call(this,e))).state={question:"",options:["",""]},n.handleChange=n.handleChange.bind(Object(I.a)(Object(I.a)(n))),n.addAnswer=n.addAnswer.bind(Object(I.a)(Object(I.a)(n))),n.handleAnswer=n.handleAnswer.bind(Object(I.a)(Object(I.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(I.a)(Object(I.a)(n))),n}return Object(q.a)(t,e),Object(M.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(U.a)({},e.target.name,e.target.value))}},{key:"addAnswer",value:function(){this.setState({options:[].concat(Object(Y.a)(this.state.options),[""])})}},{key:"handleAnswer",value:function(e,t){var n=Object(Y.a)(this.state.options);n[t]=e.target.value,this.setState({options:n})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.createPoll(this.state)}},{key:"render",value:function(){var e=this,t=this.state.options.map(function(t,n){return l.a.createElement(r.Fragment,{key:n},l.a.createElement("label",{className:"form-label"},"option"),l.a.createElement("input",{className:"form-input",type:"text",value:t,onChange:function(t){return e.handleAnswer(t,n)}}))});return l.a.createElement("form",{className:"form",onSubmit:this.handleSubmit},l.a.createElement("label",{className:"form-label",htmlFor:"question"},"Question"),l.a.createElement("input",{className:"form-input",type:"text",name:"question",value:this.state.question,onChange:this.handleChange}),t,l.a.createElement("div",{className:"button_center"},l.a.createElement("button",{className:"button",type:"button",onClick:this.addAnswer},"Add options"),l.a.createElement("button",{className:"button",type:"submit"},"Submit")))}}]),t}(r.Component),ee=Object(o.b)(function(){return{}},{createPoll:function(e){return function(){var t=Object(j.a)(g.a.mark(function t(n){var a,r;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,R.call("post","polls",e);case 3:a=t.sent,n(_(a)),n({type:"REMOVE_ERROR"}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),r=t.t0.response.data,n(E(r.message));case 12:case"end":return t.stop()}},t,null,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()}})(Z),te=function(e){return e.isAuthenticated?l.a.createElement("div",null,l.a.createElement(L,null),l.a.createElement(ee,null)):l.a.createElement(P.a,{to:"/login"})},ne=Object(T.a)(Object(o.b)(function(e){return{auth:e.auth}},{getCurrentPoll:C})(function(e){var t=e.auth,n=e.getCurrentPoll;return l.a.createElement("main",null,l.a.createElement(x.a,null,l.a.createElement(A.a,{exact:!0,path:"/",render:function(e){return l.a.createElement(G,e)}}),l.a.createElement(A.a,{exact:!0,path:"/login",render:function(){return l.a.createElement(z,{authType:"login",isAuthenticated:t.isAuthenticated})}}),l.a.createElement(A.a,{exact:!0,path:"/register",render:function(){return l.a.createElement(z,{authType:"register",isAuthenticated:t.isAuthenticated})}}),l.a.createElement(A.a,{exact:!0,path:"/poll/new",render:function(){return l.a.createElement(te,{isAuthenticated:t.isAuthenticated})}}),l.a.createElement(A.a,{exact:!0,path:"/poll/:id",render:function(e){return l.a.createElement(K,Object.assign({getPoll:function(e){return n(e)}},e))}}),l.a.createElement(A.a,{exact:!0,path:"/test",render:function(){return l.a.createElement(H,null)}})))})),ae=n(216),re=Object(o.b)(function(e){return{auth:e.auth}},{logout:N})(function(e){var t=e.auth,n=e.logout;return l.a.createElement("div",{className:"navbar"},l.a.createElement("div",{className:"container"},l.a.createElement("ul",{className:"navbar-container"},l.a.createElement("li",null,l.a.createElement(ae.a,{className:"navbar-brand navbar-item",to:"/"},"Home")),!t.isAuthenticated&&l.a.createElement(r.Fragment,null,l.a.createElement("li",null,l.a.createElement(ae.a,{className:"navbar-item",to:"/register"},"Register")),l.a.createElement("li",null,l.a.createElement(ae.a,{className:"navbar-item",to:"/login"},"Login"))),t.isAuthenticated&&l.a.createElement(r.Fragment,null,l.a.createElement("li",null,l.a.createElement(ae.a,{className:"navbar-item",to:"/poll/new"},"New poll")),l.a.createElement("li",null,l.a.createElement("span",{className:"navbar-item",onClick:n},"Logout")))),t.isAuthenticated&&l.a.createElement("p",{className:"navbar-user"},"Logged in as ",t.user.username)))});if(localStorage.jwtToken){a=localStorage.jwtToken,R.setToken(a);try{f.dispatch(k(i()(localStorage.jwtToken)))}catch(ce){f.dispatch(k({})),f.dispatch(E(ce))}}var le=function(){return l.a.createElement(o.a,{store:f},l.a.createElement(u.a,null,l.a.createElement(r.Fragment,null,l.a.createElement(re,null),l.a.createElement(ne,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(c.render)(l.a.createElement(le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},84:function(e,t,n){e.exports=n(214)},89:function(e,t,n){}},[[84,1,2]]]);
//# sourceMappingURL=main.963e5e9b.chunk.js.map